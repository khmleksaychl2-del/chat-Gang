<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chat App</title>
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg, #74ABE2, #5563DE);
    display: flex;
    flex-direction: column;
    height: 100vh;
    color: #fff;
  }

  #login {
    margin: auto;
    text-align: center;
  }

  #login input {
    padding: 10px;
    border-radius: 8px;
    border: none;
    width: 200px;
    margin-right: 5px;
  }

  #login button {
    padding: 10px 15px;
    border: none;
    border-radius: 8px;
    background: #00C9A7;
    color: #fff;
    font-weight: bold;
    cursor: pointer;
  }

  #chat {
    display: flex;
    flex-direction: column;
    flex: 1;
    padding: 10px;
  }

  #messages {
    flex: 1;
    overflow-y: auto;
    padding: 10px;
  }

  .msg {
    max-width: 70%;
    padding: 10px;
    border-radius: 12px;
    margin: 5px 0;
    clear: both;
    position: relative;
  }

  .me {
    background: #00C9A7;
    color: #fff;
    float: right;
    border-bottom-right-radius: 0;
  }

  .other {
    background: #f1f1f1;
    color: #000;
    float: left;
    border-bottom-left-radius: 0;
  }

  .edit-btn, .delete-btn {
    position: absolute;
    bottom: 2px;
    font-size: 12px;
    cursor: pointer;
    padding: 2px 4px;
    border-radius: 4px;
  }

  .edit-btn {
    right: 25px;
    color: yellow;
  }

  .delete-btn {
    right: 5px;
    color: red;
  }

  #input-area {
    display: flex;
    gap: 5px;
    margin-top: auto;
  }

  #message-input {
    flex: 1;
    padding: 10px;
    border-radius: 8px;
    border: none;
  }

  #send-button, #clear-button {
    padding: 10px 15px;
    border: none;
    border-radius: 8px;
    font-weight: bold;
    cursor: pointer;
  }

  #send-button {
    background: #ff9800;
    color: #fff;
  }

  #clear-button {
    background: #e74c3c;
    color: #fff;
  }
</style>
</head>
<body>

<div id="login">
  <h2>‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h2>
  <input type="text" id="name-input" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì">
  <button id="join-button">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡πÅ‡∏ä‡∏ó</button>
</div>

<div id="chat" style="display:none;">
  <div id="messages"></div>
  <div id="input-area">
    <input type="text" id="message-input" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°...">
    <button id="send-button">‡∏™‡πà‡∏á</button>
    <button id="clear-button" style="display:none;">‡∏•‡∏ö‡πÅ‡∏ä‡∏ó‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script>
  // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyBPZr1aivETzDN7AJoYJgLxdW-uk2q7oNI",
    authDomain: "chat-app-70717.firebaseapp.com",
    databaseURL: "https://chat-app-70717-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "chat-app-70717",
    storageBucket: "chat-app-70717.firebasestorage.app",
    messagingSenderId: "710301365664",
    appId: "1:710301365664:web:3f6f0f8bc88e41bba7e0c5"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  let username = "";
  const loginDiv = document.getElementById("login");
  const chatDiv = document.getElementById("chat");
  const messagesDiv = document.getElementById("messages");
  const input = document.getElementById("message-input");
  const sendBtn = document.getElementById("send-button");
  const clearBtn = document.getElementById("clear-button");

  document.getElementById("join-button").addEventListener("click", () => {
    const nameInput = document.getElementById("name-input").value.trim();
    if (nameInput) {
      username = nameInput;
      loginDiv.style.display = "none";
      chatDiv.style.display = "flex";
      if (username.toLowerCase() === "admin") {
        clearBtn.style.display = "inline-block";
      }
    }
  });

  function renderMessage(key, data) {
    const el = document.createElement("div");
    el.className = "msg " + (data.name === username ? "me" : "other");
    el.innerHTML = `<strong>${data.name}:</strong> ${data.text}`;
    
    // ‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
    if (data.name === username || username.toLowerCase() === "admin") {
      const editBtn = document.createElement("span");
      editBtn.className = "edit-btn";
      editBtn.textContent = "‚úè";
      editBtn.onclick = () => editMessage(key, data.text);
      el.appendChild(editBtn);
    }

    // ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏ö
    if (data.name === username || username.toLowerCase() === "admin") {
      const deleteBtn = document.createElement("span");
      deleteBtn.className = "delete-btn";
      deleteBtn.textContent = "üóë";
      deleteBtn.onclick = () => deleteMessage(key);
      el.appendChild(deleteBtn);
    }

    messagesDiv.appendChild(el);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
  }

  function editMessage(key, oldText) {
    const newText = prompt("‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°:", oldText);
    if (newText !== null && newText.trim() !== "") {
      db.ref("messages/" + key).update({ text: newText });
    }
  }

  function deleteMessage(key) {
    if (confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) {
      db.ref("messages/" + key).remove();
    }
  }

  db.ref("messages").on("child_added", snap => {
    renderMessage(snap.key, snap.val());
  });

  db.ref("messages").on("child_changed", snap => {
    refreshMessages();
  });

  db.ref("messages").on("child_removed", snap => {
    refreshMessages();
  });

  function refreshMessages() {
    messagesDiv.innerHTML = "";
    db.ref("messages").once("value", snapshot => {
      snapshot.forEach(s => renderMessage(s.key, s.val()));
    });
  }

  function sendMessage() {
    const text = input.value.trim();
    if (!text) return;
    db.ref("messages").push({ name: username, text, ts: Date.now() });
    input.value = "";
    input.focus();
  }

  sendBtn.addEventListener("click", sendMessage);
  input.addEventListener("keydown", e => {
    if (e.key === "Enter") sendMessage();
  });

  clearBtn.addEventListener("click", () => {
    if (username.toLowerCase() === "admin") {
      if (confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÅ‡∏ä‡∏ó‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) {
        db.ref("messages").remove();
      }
    }
  });
</script>
</body>
</html>